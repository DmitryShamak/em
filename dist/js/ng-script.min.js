function config(e,a,t){t.html5Mode(!0),a.otherwise("/landing"),jQuery.ajaxSetup({cache:!0}),e.state("signup",{url:"/signup",templateUrl:"/views/signup.html",data:{pageTitle:"Sign Up"},controller:"SignUpCtrl"}).state("landing",{url:"/landing",templateUrl:"/views/landing.html",data:{pageTitle:"Landing"},controller:"LandingCtrl"}).state("home",{url:"/home",templateUrl:"/views/home.html",data:{pageTitle:"Home"},controller:"HomeCtrl"}).state("profile",{url:"/profile",templateUrl:"/views/profile.html",data:{pageTitle:"Profile"},controller:"ProfileCtrl"}).state("map",{url:"/map",templateUrl:"/views/map.html",data:{pageTitle:"My Map"},controller:"MapCtrl"}).state("join",{url:"/join/:id",templateUrl:"/views/scoreboard.html",data:{pageTitle:"Scoreboard"},controller:"ScoreboardCtrl"})}!function(){angular.module("app",["ngResource","ui.router","ngDialog"])}(),angular.module("app").config(config).run(function(e,a,t,n){e.getToken=function(){return $.cookie("user")},e.redirectToMainPage=function(){var e=a.current.name||t.location.pathname.substring(1);return"landing"!=e?t.location.href="/landing":void a.go(e)},e.logout=function(){t.location.href="/logout"},e.checkAuthentication=function(){var t=e.getToken(),n=a.current.name;e.user||(t&&"undefined"!=t&&(e.user=JSON.parse(t)),t&&!n&&a.go("home"))},e.checkAuthentication(),e.$on("$stateChangeStart",function(){var n=e.getToken(),o=a.current.name;!e.user&&n&&"undefined"!=n?e.user=JSON.parse(n):!e.user&&o&&"landing"!=o&&(t.location.href="/landing")}),e.apply=function(e){"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()}}),angular.module("app").controller("HomeCtrl",function(e,a,t,n,o){e.user||e.busy||a.redirectToMainPage();var i=moment().toDate();a.pageParams={},a.pageData={},a.initStats=function(e){a.pageData.stats=[],a.pageData.stats.push({priority:0,data:{count:0,title:"News",date:i}}),a.pageData.stats.push({priority:1,data:{count:0,title:"Events",date:i}}),a.pageData.stats.push({priority:2,data:{count:0,title:"Messages",date:i}}),a.pageData.stats.push({priority:3,data:{count:0,title:"Notifications",date:i}})},a.init=function(){a.pageParams.busy=!0,a.pageParams.offline=!1,a.user&&(a.initStats({}),o.user.get({name:a.user.name},function(e){a.pageParams.busy=!1},function(e){a.pageParams.busy=!1,a.pageParams.offline=!0}))},a.$watch("user",a.init)}),angular.module("app").controller("LandingCtrl",function(e,a,t,n,o){moment().toDate();a.pageParams={},a.pageData={},a.init=function(){},a.$watch("user",a.init)}),angular.module("app").controller("LogInCtrl",function(e,a,t,n,o){a.sources=[{name:"Google+",key:"google"},{name:"Instagram",key:"instagram"},{name:"Facebook",key:"facebook"}],a.authWith=function(e){var a="/auth/"+e;n.location.href=a},a.logIn=function(n){if(!a.busy){if(!n.name||!n.password)return a.invalid=!0;a.invalid=!1,a.busy=!0,o.login.save(n,function(n){a.busy=!1,document.cookie=n.token,e.user={name:n.name},t.go("landing")},function(e){console.log(e),n.password=null,a.invalid=!0,a.busy=!1})}}}),angular.module("app").controller("MapCtrl",function(e,a,t,n){e.user||e.busy||a.redirectToMainPage(),a.pageParams={},a.pageData={},a.initMap=function(e){var a=new google.maps.StyledMapType([{stylers:[{hue:"#0077ff"},{visibility:"simplified"},{gamma:.5},{saturation:-90},{weight:.5}]},{},{featureType:"water",stylers:[{color:"#3B7A94"}]}],{name:"Grey"}),t="custom_style",n=new google.maps.Map(document.getElementById("map"),{zoom:18,center:{lat:e.coords.latitude,lng:e.coords.longitude},mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,t]}});n.mapTypes.set(t,a),n.setMapTypeId(t)},a.init=function(){a.user&&(navigator.geolocation?navigator.geolocation.getCurrentPosition(a.initMap):x.innerHTML="Geolocation is not supported by this browser.")},a.$watch("user",a.init)}),angular.module("app").controller("NavigationCtrl",function(e,a){e.updateNotificationCount=function(){e.notificationsCount=0},e.sources=[{name:"Google+",key:"google"}],e.authWith=function(e){var t="/auth/"+e;a.location.href=t},e.navigation={};var t={};t.landing={title:"Landing",state:"landing",icon:"fa-info"},t.home={title:"Home",state:"home",icon:"fa-home",value:e.notificationsCount||0},t.sources={title:"Map",state:"map",icon:"fa-map-marker",value:e.mewMarkers||0},e.navigation.topLinks=t;var n={};n.landing={title:"Landing",actstate:"landing",icon:"fa-sign-out"},e.user?n.logout={title:"Log Out",action:e.logout,icon:"fa-sign-out"}:_.forEach(e.sources,function(a){n[a.name]={title:"Sign In with "+a.name,action:function(){e.authWith(a.key)},icon:"fa-"+a.key}}),e.navigation.bottomLinks=n}),angular.module("app").controller("ProfileCtrl",function(e,a,t,n,o){e.user||e.busy||a.redirectToMainPage();var i=function(e){var a=this;a.name=e.name,a.lastname=e.lastname,a.dob=moment(e.dob).toDate(),a.address=e.address,a.email=e.email,a.phone=e.phone};a.pageParams={busy:!0},a.updateProfile=function(e){a.pageParams.busy=!0,a.pageParams.offline=!1;var t=new i(e);o.user.update({query:{_id:a.user._id},updates:t},function(){a.pageParams.busy=!1,a.pageParams.offline=!1},function(e){a.pageParams.busy=!1,a.pageParams.offline=!0})},a.resetChanges=function(){a.userProfile=new i(a.userBackup)},a.init=function(){a.pageParams.busy=!1,a.pageParams.offline=!1,a.user&&(a.pageParams.busy=!0,o.user.get({_id:a.user._id},function(e){a.userProfile=new i(e),a.userBackup=angular.copy(e),a.pageParams.busy=!1,a.pageParams.offline=!1},function(e){a.pageParams.busy=!1,a.pageParams.offline=!0}))},a.$watch("user",a.init)}),angular.module("app").controller("SignUpCtrl",function(e,a,t,n){a.userData={},a.signIn=function(o){a.busy||(a.invalid=!1,a.busy=!0,n.user.save({name:o.name,password:o.password},function(a){document.cookie=a.token,e.user={name:o.name},t.go("landing")},function(e){console.log(e),a.invalid=!0,a.busy=!1}))}}),angular.module("app").directive("globalStats",function(){return{templateUrl:"/views/common/global_stats.html",scope:{stats:"=globalStats"},controller:function(e,a){e.selectItem=function(a){e.activeItem={title:a.data.title,data:[]}}}}}),angular.module("app").directive("navigation",function(){return{templateUrl:"/views/navigation.html",controller:"NavigationCtrl",replace:!0}}),angular.module("app").directive("navigationLink",function(){return{templateUrl:"/views/common/navigation_link.html",scope:{item:"=navigationLink"},link:function(e){}}}),angular.module("app").directive("pageTitle",function(e,a){return{link:function(t,n){var o=function(e,t){var o="Hi, what`s up?",i=t.data.pageTitle;a(function(){n.text(i||o)})};e.$on("$stateChangeStart",o)}}}),angular.module("app").factory("api",function(e){var a={};return a.login=e("/api/login"),a.user=e("/api/user",null,{update:{method:"PUT"}}),a.authenticate=e("/api/authenticate"),a.scoreboard=e("/api/scoreboard/:key",null,{update:{method:"PUT"}}),a.source=e("/api/source",null,{update:{method:"PUT"}}),a.search=e("/api/search"),a}),angular.module("app").factory("confirmDialog",function(e,a,t){var n={};return n.show=function(t,n){e.open({template:"/views/templates/popupTmpl.html",controller:function(o){o.rejectDelay=.5,o.increaseParams={value:1},o.data=t,o.onConfirm=function(t){t.rejectDate=moment().add(o.rejectDelay,"minutes"),t.progressStatus=0,t.inProgress=!0,t.startDiff=t.rejectDate.diff(moment()),t.timer=a(function(){var e=t.rejectDate.diff(moment()),i=(1-e/t.startDiff).toFixed(4);t.progressStatus=Math.min(i,1),t.progressTimeLeft=t.rejectDate.fromNow(),t.progressStatus>=1&&(n.increaseNumber(t,o.increaseParams.value),a.cancel(t.timer))},t.startDiff/1e3),e.close()},o.onCancel=function(){e.close()}}})},n}),angular.module("app").factory("inviteDialog",function(e,a,t){var n={};return n.show=function(a){e.open({template:"/views/templates/inviteTmpl.html",controller:function(n){n.onConfirm=function(o){return o.name&&o.name!=n.user.name?void t.user.get({name:o.name},function(t){a.getEmptyNum(o.name);e.close()},function(e){console.error("No such user")}):console.info("Invalid user")},n.onCancel=function(){e.close()}}})},n}),angular.module("app").factory("notify",function(e,a){var t={};return t.show=function(e){var n=$("<div class='text-center animated fadeInDown notify'></div>");n.text(e.text),n.addClass("alert alert-"+(e.type||"info")),$("body").append(n),a(function(){t.hide(n)},3e3)},t.hide=function(e){e.hide().delay(200).remove()},t}),angular.module("app").filter("date",function(){return function(e){return moment(e).format("DD/MM/YY")}});