function config(e,n,a){a.html5Mode(!0),n.otherwise("/login"),jQuery.ajaxSetup({cache:!0}),e.state("signup",{url:"/signup",templateUrl:"/views/signup.html",data:{pageTitle:"Sign Up"},controller:"SignUpCtrl"}).state("login",{url:"/login",templateUrl:"/views/login.html",data:{pageTitle:"LogIn"},controller:"LogInCtrl"}).state("logout",{url:"/logout",data:{pageTitle:"Log Out"},controller:function(e,n){e.user=null,document.cookie=null,n.go("login")}}).state("landing",{url:"/landing",templateUrl:"/views/landing.html",data:{pageTitle:"Landing"},controller:"LandingCtrl"}).state("profile",{url:"/profile",templateUrl:"/views/profile.html",data:{pageTitle:"Profile"},controller:"ProfileCtrl"}).state("join",{url:"/join/:id",templateUrl:"/views/scoreboard.html",data:{pageTitle:"Scoreboard"},controller:"ScoreboardCtrl"})}!function(){angular.module("app",["ngResource","ui.router","ngDialog"])}(),angular.module("app").config(config).run(function(e,n,a,t){e.getToken=function(){var e,n=document.cookie.split(";");return _.forEach(n,function(n){" "==n.charAt(0)&&(e=n.substring(1))}),e},e.redirectToMainPage=function(){n.go("landing")},e.checkAuthentication=function(){if(!e.user){e.busy=!1;var t=a.get("api"),o=e.getToken();o||n.go("login"),e.busy=!0,t.authenticate.save({token:o},function(a){e.user=a;var t=n.current.name;"login"===t?e.redirectToMainPage():n.go(t),e.busy=!1},function(a){n.go("login"),e.busy=!1})}},e.checkAuthentication(),e.apply=function(e){"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply()}}),angular.module("app").controller("LandingCtrl",function(e,n,a,t,o){e.user||e.busy||t.go("login"),n.pageParams={},n.init=function(){n.pageParams.busy=!0,n.pageParams.offline=!1,n.user&&o.user.get({name:n.user.name},function(e){n.pageParams.busy=!1},function(e){n.pageParams.busy=!1,n.pageParams.offline=!0})},n.$watch("user",n.init)}),angular.module("app").controller("LogInCtrl",function(e,n,a,t){n.userData={},n.logIn=function(o){if(!n.busy){if(!o.name||!o.password)return n.invalid=!0;n.invalid=!1,n.busy=!0,t.login.save(o,function(t){n.busy=!1,document.cookie=t.token,e.user={name:t.name},a.go("landing")},function(e){console.log(e),o.password=null,n.invalid=!0,n.busy=!1})}}}),angular.module("app").controller("NavigationCtrl",function(e){e.updateNotificationCount=function(){e.notificationsCount=0},e.navigation={};var n={};n.landing={title:"Home",state:"landing",icon:"fa-home",value:e.notificationsCount||0},n.sources={title:"Map",state:"map",icon:"fa-map-marker",value:e.mewMarkers||0},e.navigation.topLinks=n;var a={};a.logout={title:"Log Out",state:"logout",icon:"fa-sign-out"},e.navigation.bottomLinks=a}),angular.module("app").controller("ProfileCtrl",function(e,n,a,t,o){e.user||e.busy||t.go("login");var i=function(e){var n=this;n.name=e.name,n.lastname=e.lastname,n.dob=moment(e.dob).toDate(),n.address=e.address,n.email=e.email,n.phone=e.phone};n.pageParams={busy:!0},n.updateProfile=function(e){n.pageParams.busy=!0,n.pageParams.offline=!1;var a=new i(e);o.user.update({query:{_id:n.user._id},updates:a},function(){n.pageParams.busy=!1,n.pageParams.offline=!1},function(e){n.pageParams.busy=!1,n.pageParams.offline=!0})},n.resetChanges=function(){n.userProfile=new i(n.userBackup)},n.init=function(){n.pageParams.busy=!1,n.pageParams.offline=!1,n.user&&(n.pageParams.busy=!0,o.user.get({_id:n.user._id},function(e){n.userProfile=new i(e),n.userBackup=angular.copy(e),n.pageParams.busy=!1,n.pageParams.offline=!1},function(e){n.pageParams.busy=!1,n.pageParams.offline=!0}))},n.$watch("user",n.init)}),angular.module("app").controller("SignUpCtrl",function(e,n,a,t){n.userData={},n.signIn=function(o){n.busy||(n.invalid=!1,n.busy=!0,t.user.save({name:o.name,password:o.password},function(n){document.cookie=n.token,e.user={name:o.name},a.go("landing")},function(e){console.log(e),n.invalid=!0,n.busy=!1}))}}),angular.module("app").directive("navigation",function(){return{templateUrl:"/views/navigation.html",controller:"NavigationCtrl",replace:!0}}),angular.module("app").directive("navigationLink",function(){return{templateUrl:"/views/common/navigation_link.html",scope:{item:"=navigationLink"},link:function(e){}}}),angular.module("app").directive("pageTitle",function(e,n){return{link:function(a,t){var o=function(e,a){var o="Hi, what`s up?",i=a.data.pageTitle;n(function(){t.text(i||o)})};e.$on("$stateChangeStart",o)}}}),angular.module("app").factory("api",function(e){var n={};return n.login=e("/api/login"),n.user=e("/api/user",null,{update:{method:"PUT"}}),n.authenticate=e("/api/authenticate"),n.scoreboard=e("/api/scoreboard/:key",null,{update:{method:"PUT"}}),n.source=e("/api/source",null,{update:{method:"PUT"}}),n.search=e("/api/search"),n}),angular.module("app").factory("confirmDialog",function(e,n,a){var t={};return t.show=function(a,t){e.open({template:"/views/templates/popupTmpl.html",controller:function(o){o.rejectDelay=.5,o.increaseParams={value:1},o.data=a,o.onConfirm=function(a){a.rejectDate=moment().add(o.rejectDelay,"minutes"),a.progressStatus=0,a.inProgress=!0,a.startDiff=a.rejectDate.diff(moment()),a.timer=n(function(){var e=a.rejectDate.diff(moment()),i=(1-e/a.startDiff).toFixed(4);a.progressStatus=Math.min(i,1),a.progressTimeLeft=a.rejectDate.fromNow(),a.progressStatus>=1&&(t.increaseNumber(a,o.increaseParams.value),n.cancel(a.timer))},a.startDiff/1e3),e.close()},o.onCancel=function(){e.close()}}})},t}),angular.module("app").factory("inviteDialog",function(e,n,a){var t={};return t.show=function(n){e.open({template:"/views/templates/inviteTmpl.html",controller:function(t){t.onConfirm=function(o){return o.name&&o.name!=t.user.name?void a.user.get({name:o.name},function(a){n.getEmptyNum(o.name);e.close()},function(e){console.error("No such user")}):console.info("Invalid user")},t.onCancel=function(){e.close()}}})},t}),angular.module("app").factory("notify",function(e,n){var a={};return a.show=function(e){var t=$("<div class='text-center animated fadeInDown notify'></div>");t.text(e.text),t.addClass("alert alert-"+(e.type||"info")),$("body").append(t),n(function(){a.hide(t)},3e3)},a.hide=function(e){e.hide().delay(200).remove()},a});